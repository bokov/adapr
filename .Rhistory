}
xy <- xy[excluder01(xy),]
xy <- as.matrix(xy[,-ncol(xy)])
xcol <- colnames(xy[,-c(1,2)])
penalties <- rep(1,length(xcol))
penalties[xcol %in% clinicals] <- 1
msds <- t(xy[,msd.vars])
msds2 <- normalizeQuantiles(msds)
afr.status <- xy[,"afr_strat"]
smear <- xy[,"smear_who_0"]
Cav4cm <- xy[,"Cav4cm"]
CXRExtent <- xy[,"CXRExtent"]
afr_status <- afr.status
ttd <- xy[,"ttd"]
pretreatment <- xy[,""]
design <- model.matrix(~1+afr_status+smear+Cav4cm + CXRExtent+ttd)
vars <- c("afr_status","smear","Cav4cm","CXRExtent","ttd","Pretreated")
var.iter <- vars[1]
fit <- lmFit(msds2,design)
fit2 <- eBayes(fit)
topfits <- list()
smear <- xy[,"smear_who_0"]
Cav4cm <- xy[,"Cav4cm"]
CXRExtent <- xy[,"CXRExtent"]
afr_status <- afr.status
ttd <- xy[,"ttd"]
pretreatment <- xy[,"Pretreated"]
design <- model.matrix(~1+afr_status+smear+Cav4cm + CXRExtent+ttd+pretreatment)
vars <- c("afr_status","smear","Cav4cm","CXRExtent","ttd","Pretreated")
var.iter <- vars[1]
fit <- lmFit(msds2,design)
fit2 <- eBayes(fit)
topfits <- list()
msds2 <- normalizeQuantiles(msds)
pretreat$Pretreated
rm(list=ls())
set.seed( 2011 )
library(adapr)
library(gdata)
library(gplots)
library(ggplot2)
library(VarSummarize)
library(car)
library(glmnet)
library(rtfR)
library(limma)
library(survival)
library(knitr)
source.file <-"msds_compare_African_pretreat.R"
project.id <- "TB_adapr"
source_info <- create_source_file_dir(source.description="reads data")
# Program body here
msd2 <- load(file.path(source_info$data.dir,"msds.Rdata"))
msd2 <- Load.branch("msds.Rdata")
msd2 <- obj
msd2$ttd <- as.numeric(as.character(msd2$ttd))
msd8 <- load(file.path(source_info$data.dir,"msds_8.Rdata"))
msd8 <- obj
msd8 <- Load.branch("msds_8.Rdata")
msd2$TTSC <- Surv(msd2$mtb_l_on_days_sc,msd2$mtb_l_sc)
survout <- survfit(TTSC~1,data=msd2)
msd2$ResponseSpeed <- 0.5
msd2$ResponseSpeed <- ifelse((msd2$mtb_l_on_days_sc<=(4*7))&(msd2$mtb_l_sc==1),1,msd2$ResponseSpeed)
msd2$ResponseSpeed <- ifelse((msd2$mtb_l_on_days_sc>=(8*7)),0,msd2$ResponseSpeed)
table(msd2$ResponseSpeed )
msd2$RPTauc350 <- 1*msd2$AUC24_RPT>350
msd2$Cav4cm <- 1*(msd2$cxrclass==3)
survout <- survfit(TTSC~1,data=msd2)
survout2 <- survfit(TTSC~RPTauc350,data=msd2)
pval <- summary(coxph(TTSC~RPTauc350,data=msd2))$coef[,5]
msd2$CXRExtent <- ifelse(msd2$cxrextnt=="C",1,0)
pretreat <- Load.branch("preTreated.Rdata")
pretreat$Pretreated <- ifelse(pretreat$Pretreated=="PreTreated1wk",1,0)
msd2 <- merge(msd2,subset(pretreat,select=c("Study_ID","Pretreated")))
clinicals <- c("afr_strat","smear_who_0","Cav4cm","CXRExtent","ttd","Pretreated")
first.var <- which(names(msd2)=="RANTES")
last.var <- which(names(msd2)=="VitD_BP")
vars <- names(msd2)[first.var:last.var]
msd.vars <- vars
msd2$Site <- substring(msd2$Study_ID,4,5)
xmat <- subset(msd2,select=c("mtb_l_on_days_sc","mtb_l_sc",msd.vars,clinicals,"Study_ID"))
xmat8 <- subset(msd8,select=c("Study_ID",msd.vars))
names(xmat8)[-1] <- paste0(names(xmat8)[-1],"8wk")
for(i in msd.vars){
xmat[[i]] <- log2(as.numeric(as.character(xmat[[i]])))
}
msds <- subset(msd2,select=c(msd.vars,"Site","ResponseSpeed"))
for(i in msd.vars){
msds[[i]] <- scale(log2(as.numeric(as.character(msds[[i]]))))
}
msds <- na.exclude(msds)
msds$Site <- as.numeric(as.character(msds$Site ))
xy <- as.matrix(subset(msds,select=msd.vars))
class(xy) <- "numeric"
xy2 <- xy
msds$Response <- c("<4wks","4-8wks",">8wks")[as.numeric(as.character(msds$ResponseSpeed))*2+1]
msds$Response <- c("<4wks","4-8wks",">8wks")[as.numeric(as.character(msds$ResponseSpeed))*2+1]
x <- as.numeric(msds[i,-ncol(msds)])
xy <- na.exclude(xmat)
excluder01 <- function(xy){
return((xy[,"mtb_l_on_days_sc"] >= 56) | (xy[,"mtb_l_sc"]>0) )
}
xy <- xy[excluder01(xy),]
xy <- as.matrix(xy[,-ncol(xy)])
xcol <- colnames(xy[,-c(1,2)])
penalties <- rep(1,length(xcol))
penalties[xcol %in% clinicals] <- 1
msds <- t(xy[,msd.vars])
msds2 <- normalizeQuantiles(msds)
afr.status <- xy[,"afr_strat"]
smear <- xy[,"smear_who_0"]
Cav4cm <- xy[,"Cav4cm"]
CXRExtent <- xy[,"CXRExtent"]
afr_status <- afr.status
ttd <- xy[,"ttd"]
pretreatment <- xy[,"Pretreated"]
design <- model.matrix(~1+afr_status+smear+Cav4cm + CXRExtent+ttd+pretreatment)
vars <- c("afr_status","smear","Cav4cm","CXRExtent","ttd","Pretreated")
var.iter <- vars[1]
fit <- lmFit(msds2,design)
fit2 <- eBayes(fit)
topfits <- list()
Graph("msds_baseline_comparison.pdf")
heatmap.2(msds2,trace="none",ColSideColors=ifelse(afr.status==1,"red","black"))
legend("top",bg="white",legend=c("African","Non African"),pch=19,col=c("red","black"))
for(var.iter in vars){
toptab <- topTable(fit2,number=nrow(msds),coef=which(colnames(design)==var.iter))
plot(toptab$logFC,-log10(toptab$adj.P.Val),main=paste("Contrast for",var.iter))
text(toptab$logFC,-log10(toptab$adj.P.Val),rownames(toptab),col="red")
Write(toptab,paste0(var.iter,"_msds_baseline.csv"),"from limma Quantile normed")
toptab2 <- toptab
toptab2$Cytokine <- rownames(toptab2)
toptab2$FDR <- p.rounder(toptab2$adj.P.Val)
toptab2$FoldChange <- exp(abs(toptab2$logFC))*sign(toptab2$logFC)
toptab2 <- round.data(toptab2,3)
toptab2 <- dplyr::select(toptab2,Cytokine,FoldChange,FDR)[1:20,]
Write(toptab2,paste0(var.iter,"_msds_baseline_rounded.csv"),"from limma Quantile normed")
}
graphics.off()
smear <- xy[,"smear_who_0"]
Cav4cm <- xy[,"Cav4cm"]
CXRExtent <- xy[,"CXRExtent"]
afr_status <- afr.status
ttd <- xy[,"ttd"]
pretreatment <- xy[,"Pretreated"]
design <- model.matrix(~1+afr_status+smear+Cav4cm + CXRExtent+ttd+pretreatment)
vars <- c("afr_status","smear","Cav4cm","CXRExtent","ttd","pretreatment")
var.iter <- vars[1]
fit <- lmFit(msds2,design)
fit2 <- eBayes(fit)
topfits <- list()
Graph("msds_baseline_comparison.pdf")
heatmap.2(msds2,trace="none",ColSideColors=ifelse(afr.status==1,"red","black"))
legend("top",bg="white",legend=c("African","Non African"),pch=19,col=c("red","black"))
for(var.iter in vars){
toptab <- topTable(fit2,number=nrow(msds),coef=which(colnames(design)==var.iter))
plot(toptab$logFC,-log10(toptab$adj.P.Val),main=paste("Contrast for",var.iter))
text(toptab$logFC,-log10(toptab$adj.P.Val),rownames(toptab),col="red")
Write(toptab,paste0(var.iter,"_msds_baseline.csv"),"from limma Quantile normed")
toptab2 <- toptab
toptab2$Cytokine <- rownames(toptab2)
toptab2$FDR <- p.rounder(toptab2$adj.P.Val)
toptab2$FoldChange <- exp(abs(toptab2$logFC))*sign(toptab2$logFC)
toptab2 <- round.data(toptab2,3)
toptab2 <- dplyr::select(toptab2,Cytokine,FoldChange,FDR)[1:20,]
Write(toptab2,paste0(var.iter,"_msds_baseline_rounded.csv"),"from limma Quantile normed")
}
graphics.off()
xy <- xy[xy[,"Pretreated"]==0]
afr.status <- xy[,"afr_strat"]
smear <- xy[,"smear_who_0"]
Cav4cm <- xy[,"Cav4cm"]
CXRExtent <- xy[,"CXRExtent"]
afr_status <- afr.status
ttd <- xy[,"ttd"]
pretreatment <- xy[,"Pretreated"]
design <- model.matrix(~1+afr_status+smear+Cav4cm + CXRExtent+ttd+pretreatment)
vars <- c("afr_status","smear","Cav4cm","CXRExtent","ttd","pretreatment")
var.iter <- vars[1]
fit <- lmFit(msds2,design)
fit2 <- eBayes(fit)
topfits <- list()
Graph("msds_baseline_comparison.pdf")
heatmap.2(msds2,trace="none",ColSideColors=ifelse(afr.status==1,"red","black"))
legend("top",bg="white",legend=c("African","Non African"),pch=19,col=c("red","black"))
for(var.iter in vars){
toptab <- topTable(fit2,number=nrow(msds),coef=which(colnames(design)==var.iter))
plot(toptab$logFC,-log10(toptab$adj.P.Val),main=paste("Contrast for",var.iter))
text(toptab$logFC,-log10(toptab$adj.P.Val),rownames(toptab),col="red")
Write(toptab,paste0(var.iter,"_msds_baseline.csv"),"from limma Quantile normed")
toptab2 <- toptab
toptab2$Cytokine <- rownames(toptab2)
toptab2$FDR <- p.rounder(toptab2$adj.P.Val)
toptab2$FoldChange <- exp(abs(toptab2$logFC))*sign(toptab2$logFC)
toptab2 <- round.data(toptab2,3)
toptab2 <- dplyr::select(toptab2,Cytokine,FoldChange,FDR)[1:20,]
Write(toptab2,paste0(var.iter,"_msds_baseline_rounded.csv"),"from limma Quantile normed")
}
graphics.off()
nrow(msds2)
msds2
ncol(msds2)
nrow(msds)
dim(msds)
dim(msds2)
dim(xy)
rm(list=ls())
set.seed( 2011 )
library(adapr)
library(gdata)
library(gplots)
library(ggplot2)
library(VarSummarize)
library(car)
library(glmnet)
library(rtfR)
library(limma)
library(survival)
library(knitr)
source.file <-"msds_compare_African_pretreat.R"
project.id <- "TB_adapr"
source_info <- create_source_file_dir(source.description="reads data")
# Program body here
msd2 <- load(file.path(source_info$data.dir,"msds.Rdata"))
msd2 <- Load.branch("msds.Rdata")
msd2 <- obj
msd2$ttd <- as.numeric(as.character(msd2$ttd))
msd8 <- load(file.path(source_info$data.dir,"msds_8.Rdata"))
msd8 <- obj
msd8 <- Load.branch("msds_8.Rdata")
msd2$TTSC <- Surv(msd2$mtb_l_on_days_sc,msd2$mtb_l_sc)
survout <- survfit(TTSC~1,data=msd2)
msd2$ResponseSpeed <- 0.5
msd2$ResponseSpeed <- ifelse((msd2$mtb_l_on_days_sc<=(4*7))&(msd2$mtb_l_sc==1),1,msd2$ResponseSpeed)
msd2$ResponseSpeed <- ifelse((msd2$mtb_l_on_days_sc>=(8*7)),0,msd2$ResponseSpeed)
table(msd2$ResponseSpeed )
msd2$RPTauc350 <- 1*msd2$AUC24_RPT>350
msd2$Cav4cm <- 1*(msd2$cxrclass==3)
survout <- survfit(TTSC~1,data=msd2)
survout2 <- survfit(TTSC~RPTauc350,data=msd2)
pval <- summary(coxph(TTSC~RPTauc350,data=msd2))$coef[,5]
msd2$CXRExtent <- ifelse(msd2$cxrextnt=="C",1,0)
pretreat <- Load.branch("preTreated.Rdata")
pretreat$Pretreated <- ifelse(pretreat$Pretreated=="PreTreated1wk",1,0)
msd2 <- merge(msd2,subset(pretreat,select=c("Study_ID","Pretreated")))
clinicals <- c("afr_strat","smear_who_0","Cav4cm","CXRExtent","ttd","Pretreated")
first.var <- which(names(msd2)=="RANTES")
last.var <- which(names(msd2)=="VitD_BP")
vars <- names(msd2)[first.var:last.var]
msd.vars <- vars
msd2$Site <- substring(msd2$Study_ID,4,5)
xmat <- subset(msd2,select=c("mtb_l_on_days_sc","mtb_l_sc",msd.vars,clinicals,"Study_ID"))
xmat8 <- subset(msd8,select=c("Study_ID",msd.vars))
names(xmat8)[-1] <- paste0(names(xmat8)[-1],"8wk")
for(i in msd.vars){
xmat[[i]] <- log2(as.numeric(as.character(xmat[[i]])))
}
msds <- subset(msd2,select=c(msd.vars,"Site","ResponseSpeed"))
for(i in msd.vars){
msds[[i]] <- scale(log2(as.numeric(as.character(msds[[i]]))))
}
msds <- na.exclude(msds)
msds$Site <- as.numeric(as.character(msds$Site ))
xy <- as.matrix(subset(msds,select=msd.vars))
class(xy) <- "numeric"
xy2 <- xy
msds$Response <- c("<4wks","4-8wks",">8wks")[as.numeric(as.character(msds$ResponseSpeed))*2+1]
msds$Response <- c("<4wks","4-8wks",">8wks")[as.numeric(as.character(msds$ResponseSpeed))*2+1]
x <- as.numeric(msds[i,-ncol(msds)])
xy <- na.exclude(xmat)
excluder01 <- function(xy){
return((xy[,"mtb_l_on_days_sc"] >= 56) | (xy[,"mtb_l_sc"]>0) )
}
xy <- xy[excluder01(xy),]
xy <- as.matrix(xy[,-ncol(xy)])
xcol <- colnames(xy[,-c(1,2)])
penalties <- rep(1,length(xcol))
penalties[xcol %in% clinicals] <- 1
msds <- t(xy[,msd.vars])
msds2 <- normalizeQuantiles(msds)
afr.status <- xy[,"afr_strat"]
smear <- xy[,"smear_who_0"]
Cav4cm <- xy[,"Cav4cm"]
CXRExtent <- xy[,"CXRExtent"]
afr_status <- afr.status
ttd <- xy[,"ttd"]
pretreatment <- xy[,"Pretreated"]
design <- model.matrix(~1+afr_status+smear+Cav4cm + CXRExtent+ttd+pretreatment)
vars <- c("afr_status","smear","Cav4cm","CXRExtent","ttd","pretreatment")
var.iter <- vars[1]
fit <- lmFit(msds2,design)
fit2 <- eBayes(fit)
topfits <- list()
Graph("msds_baseline_comparison.pdf")
heatmap.2(msds2,trace="none",ColSideColors=ifelse(afr.status==1,"red","black"))
legend("top",bg="white",legend=c("African","Non African"),pch=19,col=c("red","black"))
for(var.iter in vars){
toptab <- topTable(fit2,number=nrow(msds),coef=which(colnames(design)==var.iter))
plot(toptab$logFC,-log10(toptab$adj.P.Val),main=paste("Contrast for",var.iter))
text(toptab$logFC,-log10(toptab$adj.P.Val),rownames(toptab),col="red")
Write(toptab,paste0(var.iter,"_msds_baseline.csv"),"from limma Quantile normed")
toptab2 <- toptab
toptab2$Cytokine <- rownames(toptab2)
toptab2$FDR <- p.rounder(toptab2$adj.P.Val)
toptab2$FoldChange <- exp(abs(toptab2$logFC))*sign(toptab2$logFC)
toptab2 <- round.data(toptab2,3)
toptab2 <- dplyr::select(toptab2,Cytokine,FoldChange,FDR)[1:20,]
Write(toptab2,paste0(var.iter,"_msds_baseline_rounded.csv"),"from limma Quantile normed")
}
graphics.off()
# Perform univariate survival analysis
xy <- xy[xy[,"Pretreated"]==0,]
head(msd8)
dim(xy)
dim(msds2)
msds <- t(xy[,msd.vars])
msds2 <- normalizeQuantiles(msds)
afr.status <- xy[,"afr_strat"]
smear <- xy[,"smear_who_0"]
Cav4cm <- xy[,"Cav4cm"]
CXRExtent <- xy[,"CXRExtent"]
afr_status <- afr.status
ttd <- xy[,"ttd"]
pretreatment <- xy[,"Pretreated"]
design <- model.matrix(~1+afr_status+smear+Cav4cm + CXRExtent+ttd+pretreatment)
vars <- c("afr_status","smear","Cav4cm","CXRExtent","ttd","pretreatment")
var.iter <- vars[1]
fit <- lmFit(msds2,design)
fit2 <- eBayes(fit)
topfits <- list()
Graph("msds_baseline_comparison.pdf")
heatmap.2(msds2,trace="none",ColSideColors=ifelse(afr.status==1,"red","black"))
legend("top",bg="white",legend=c("African","Non African"),pch=19,col=c("red","black"))
for(var.iter in vars){
toptab <- topTable(fit2,number=nrow(msds),coef=which(colnames(design)==var.iter))
plot(toptab$logFC,-log10(toptab$adj.P.Val),main=paste("Contrast for",var.iter))
text(toptab$logFC,-log10(toptab$adj.P.Val),rownames(toptab),col="red")
Write(toptab,paste0(var.iter,"_msds_baseline.csv"),"from limma Quantile normed")
toptab2 <- toptab
toptab2$Cytokine <- rownames(toptab2)
toptab2$FDR <- p.rounder(toptab2$adj.P.Val)
toptab2$FoldChange <- exp(abs(toptab2$logFC))*sign(toptab2$logFC)
toptab2 <- round.data(toptab2,3)
toptab2 <- dplyr::select(toptab2,Cytokine,FoldChange,FDR)[1:20,]
Write(toptab2,paste0(var.iter,"_msds_baseline_rounded.csv"),"from limma Quantile normed")
}
graphics.off()
# Perform univariate survival analysis
xy <- xy[xy[,"Pretreated"]==0,]
afr.status <- xy[,"afr_strat"]
smear <- xy[,"smear_who_0"]
Cav4cm <- xy[,"Cav4cm"]
CXRExtent <- xy[,"CXRExtent"]
afr_status <- afr.status
ttd <- xy[,"ttd"]
pretreatment <- xy[,"Pretreated"]
design <- model.matrix(~1+afr_status+smear+Cav4cm + CXRExtent+ttd+pretreatment)
vars <- c("afr_status","smear","Cav4cm","CXRExtent","ttd","pretreatment")
var.iter <- vars[1]
source('~/Documents/Projects/TB_adapr/Programs/msds_compare_African_pretreat.R')
with(msd2,table(afr_status,Pretreated))
rm(list=ls())
set.seed( 2011 )
library(adapr)
library(gdata)
library(gplots)
library(ggplot2)
library(VarSummarize)
library(car)
library(glmnet)
library(rtfR)
library(limma)
library(survival)
library(knitr)
source.file <-"msds_compare_African_pretreat.R"
project.id <- "TB_adapr"
source_info <- create_source_file_dir(source.description="reads data")
# Program body here
msd2 <- load(file.path(source_info$data.dir,"msds.Rdata"))
msd2 <- Load.branch("msds.Rdata")
msd2 <- obj
msd2$ttd <- as.numeric(as.character(msd2$ttd))
msd8 <- load(file.path(source_info$data.dir,"msds_8.Rdata"))
msd8 <- obj
msd8 <- Load.branch("msds_8.Rdata")
msd2$TTSC <- Surv(msd2$mtb_l_on_days_sc,msd2$mtb_l_sc)
survout <- survfit(TTSC~1,data=msd2)
msd2$ResponseSpeed <- 0.5
msd2$ResponseSpeed <- ifelse((msd2$mtb_l_on_days_sc<=(4*7))&(msd2$mtb_l_sc==1),1,msd2$ResponseSpeed)
msd2$ResponseSpeed <- ifelse((msd2$mtb_l_on_days_sc>=(8*7)),0,msd2$ResponseSpeed)
table(msd2$ResponseSpeed )
msd2$RPTauc350 <- 1*msd2$AUC24_RPT>350
msd2$Cav4cm <- 1*(msd2$cxrclass==3)
survout <- survfit(TTSC~1,data=msd2)
survout2 <- survfit(TTSC~RPTauc350,data=msd2)
pval <- summary(coxph(TTSC~RPTauc350,data=msd2))$coef[,5]
msd2$CXRExtent <- ifelse(msd2$cxrextnt=="C",1,0)
pretreat <- Load.branch("preTreated.Rdata")
pretreat$Pretreated <- ifelse(pretreat$Pretreated=="PreTreated1wk",1,0)
msd2 <- merge(msd2,subset(pretreat,Pretreated==1,select=c("Study_ID","Pretreated")))
with(msd2,table(afr_status,Pretreated))
head(msd2)
with(msd2,table(afr_strat,Pretreated))
head(pretreat)
pretreat$diffdate <- as.numeric(pretreat$diffdate)
msd2 <- merge(msd2,subset(pretreat,Pretreated==1,select=c("Study_ID","Pretreated","diffdate")))
with(msd2,table(afr_strat,Pretreated))
rm(list=ls())
set.seed( 2011 )
library(adapr)
library(gdata)
library(gplots)
library(ggplot2)
library(VarSummarize)
library(car)
library(glmnet)
library(rtfR)
library(limma)
library(survival)
library(knitr)
source.file <-"msds_compare_African_pretreat.R"
project.id <- "TB_adapr"
source_info <- create_source_file_dir(source.description="reads data")
# Program body here
msd2 <- load(file.path(source_info$data.dir,"msds.Rdata"))
msd2 <- Load.branch("msds.Rdata")
msd2 <- obj
msd2$ttd <- as.numeric(as.character(msd2$ttd))
msd8 <- load(file.path(source_info$data.dir,"msds_8.Rdata"))
msd8 <- obj
msd8 <- Load.branch("msds_8.Rdata")
msd2$TTSC <- Surv(msd2$mtb_l_on_days_sc,msd2$mtb_l_sc)
survout <- survfit(TTSC~1,data=msd2)
msd2$ResponseSpeed <- 0.5
msd2$ResponseSpeed <- ifelse((msd2$mtb_l_on_days_sc<=(4*7))&(msd2$mtb_l_sc==1),1,msd2$ResponseSpeed)
msd2$ResponseSpeed <- ifelse((msd2$mtb_l_on_days_sc>=(8*7)),0,msd2$ResponseSpeed)
table(msd2$ResponseSpeed )
msd2$RPTauc350 <- 1*msd2$AUC24_RPT>350
msd2$Cav4cm <- 1*(msd2$cxrclass==3)
survout <- survfit(TTSC~1,data=msd2)
survout2 <- survfit(TTSC~RPTauc350,data=msd2)
pval <- summary(coxph(TTSC~RPTauc350,data=msd2))$coef[,5]
msd2$CXRExtent <- ifelse(msd2$cxrextnt=="C",1,0)
pretreat <- Load.branch("preTreated.Rdata")
pretreat$Pretreated <- ifelse(pretreat$Pretreated=="PreTreated1wk",1,0)
pretreat$diffdate <- as.numeric(pretreat$diffdate)
msd2 <- merge(msd2,subset(pretreat,Pretreated==1,select=c("Study_ID","Pretreated","diffdate")))
t.test(dffdate~afr_strat,data=msd2)
t.test(diffdate~afr_strat,data=msd2)
rm(list=ls())
set.seed( 2011 )
library(adapr)
library(gdata)
library(gplots)
library(ggplot2)
library(VarSummarize)
library(car)
library(glmnet)
library(rtfR)
library(limma)
library(survival)
library(knitr)
source.file <-"msds_compare_African_pretreat.R"
project.id <- "TB_adapr"
source_info <- create_source_file_dir(source.description="reads data")
# Program body here
msd2 <- load(file.path(source_info$data.dir,"msds.Rdata"))
msd2 <- Load.branch("msds.Rdata")
msd2 <- obj
msd2$ttd <- as.numeric(as.character(msd2$ttd))
msd8 <- load(file.path(source_info$data.dir,"msds_8.Rdata"))
msd8 <- obj
msd8 <- Load.branch("msds_8.Rdata")
msd2$TTSC <- Surv(msd2$mtb_l_on_days_sc,msd2$mtb_l_sc)
survout <- survfit(TTSC~1,data=msd2)
msd2$ResponseSpeed <- 0.5
msd2$ResponseSpeed <- ifelse((msd2$mtb_l_on_days_sc<=(4*7))&(msd2$mtb_l_sc==1),1,msd2$ResponseSpeed)
msd2$ResponseSpeed <- ifelse((msd2$mtb_l_on_days_sc>=(8*7)),0,msd2$ResponseSpeed)
table(msd2$ResponseSpeed )
msd2$RPTauc350 <- 1*msd2$AUC24_RPT>350
msd2$Cav4cm <- 1*(msd2$cxrclass==3)
survout <- survfit(TTSC~1,data=msd2)
survout2 <- survfit(TTSC~RPTauc350,data=msd2)
pval <- summary(coxph(TTSC~RPTauc350,data=msd2))$coef[,5]
msd2$CXRExtent <- ifelse(msd2$cxrextnt=="C",1,0)
pretreat <- Load.branch("preTreated.Rdata")
pretreat$Pretreated <- ifelse(pretreat$Pretreated=="PreTreated1wk",1,0)
pretreat$diffdate <- as.numeric(pretreat$diffdate)
msd2 <- merge(msd2,subset(pretreat,select=c("Study_ID","Pretreated","diffdate")))
coxph(TTSC~Pretreated + afr_status,data=msd2)
coxph(TTSC~Pretreated + afr_strat,data=msd2)
coxph(TTSC~Pretreated + afr_strat + smear_who,data=msd2)
head(msd2)
coxph(TTSC~Pretreated + afr_strat + smear_who_0,data=msd2)
plot(survfit(TTSC~1,data=msd2))
plot(survfit(TTSC~1,data=msd2))
(survfit(TTSC~1,data=msd2))
shiny::runApp('inst/adapr21')
runApp('inst/adapr21')
source('~/Documents/Projects/test5/Programs/read_data.R')
listDatafiles()
source_info$all.files
source('~/Documents/Projects/test3/Programs/read_data.R')
listDatafiles()
source('~/Documents/Projects/adapr/R/list_files.R')
listDatafiles()
source_info$all.files
pull_source_info("N2K")
dir.exists("/Volumes/WORKING2/Projects/Hernandez/N2K")
listDatafiles()
library(adapr)
load_all()
