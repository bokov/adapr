? geom_annotate
shiny::runApp('inst/adapr21')
shiny::runApp('inst/adapr21')
? brushedPoints
shiny::runApp('inst/adapr21')
fp <- "/Users/Gelfond/Documents/Projects/adaprHome/Programs/common_libs.csv"
file.exists(fp)
fp <- "/Users/Gelfond/Documents/Projects/adaprHome/Programs/common_libs.csv"
fp <- "/Users/Gelfond/Documents/Projects/adaprHome/Programs/test_3.R"
file.exists(fp)
fp <- "/Users/Gelfond/Documents/Projects/adaprHome/Programs/test3.R"
file.exists(fp)
browseURL(fp)
shiny::runApp('inst/adapr21')
library(devtools)
load_all()
library(adapr)
library(adapr)
adapr21()
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
ggplot(year(progs$fu_rdate))
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
ggplot(year(progs$fu_rdate))
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
ggplot(progs,aes(x=year(fu_rdate)))+geom_histogram()
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
ggplot(progs,aes(x=bl_rdate)) + geom_histograom()
ggplot(progs,aes(x=bl_rdate)) + geom_histogram()
ggplot(progs,aes(x=bl_rdate)) + geom_histogram()
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
ggplot(progs,aes(x=year(fu_rdate)))+geom_histogram()
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
year(progs$fu_rdate) <- ifelse(year(progs$fu_rdate)<10,2000,year(progs$fu_rdate))
year(progs$fu_rdate)
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
year(progs$fu_rdate) <- ifelse(year(progs$fu_rdate)<10,2000,year(progs$fu_rdate))
ggplot(progs,aes(x=year(fu_rdate)))+geom_histogram()
year(progs$fu_rdate)
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate <- ifelse(year(progs$fu_rdate)<10,2000,365.25*2000+progs$fu_rdate)
ggplot(progs,aes(x=year(fu_rdate)))+geom_histogram()
progs$fu_rdate
365.25*2000+progs$fu_rdate
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate <- ifelse(year(progs$fu_rdate)<10,2000,(as.Date("2000-01-01")-as.Date("0000-01-01"))+progs$fu_rdate)
progs$fu_rdate
(as.Date("2000-01-01")-as.Date("0000-01-01"))
365.25*2000
(as.Date("2000-01-01")-as.Date("0000-01-01"))+progs$fu_rdate
year(progs$fu_rdate)
get.project.path("PCA_Spore")
print(1)
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
#progs$fu_rdate <- ifelse(year(progs$fu_rdate)<10,2000,(as.Date("2000-01-01")-as.Date("0000-01-01"))+progs$fu_rdate)
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
ggplot(progs,aes(x=year(fu_rdate)))+geom_histogram()
data.frame(progs$fu_rdate,progs$Date.of.Progression.biopsy)
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
progs$fu_rdate2
ifelse(year(progs$fu_rdate)<10,progs$fu_rdate2 ,progs$fu_rdate)
progs$fu_rdate2
progs$fu_rdate
progs$fu_rdate[year(progs$fu_rdate)<10]
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
progs$fu_rdate[year(progs$fu_rdate)<10]
year(progs$fu_rdate)
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
year(progs$fu_rdate)
progs$fu_rdate[year(progs$fu_rdate)<10]
year(progs$fu_rdate)<10
progs$fu_rdate2
progs <- Read("Copy of PASS Enrollment - 2.27.2016 - 30% have progressed.csv","progression data",as.is=TRUE)
progs <- subset(progs,progs$Name...MRN!="")
progs$bl_rdate <- as.Date(progs$Date.of.initial.diagnosis,format="%m/%d/%Y")
ggplot(progs,aes(x=bl_rdate)) + geom_histogram()
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
View(progs)
year(progs$fu_rdate)
ifelse(year(progs$fu_rdate)<10,progs$fu_rdate2 ,progs$fu_rdate)
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
year(progs$fu_rdate)
year(progs$fu_rdate)<10
class(year(progs$fu_rdate))
table(year(progs$fu_rdate)<10)
ifelse(year(progs$fu_rdate)<100,progs$fu_rdate2 ,progs$fu_rdate)
progs$fu_rdate2
progs$fu_rdate
as.Date(ifelse(year(progs$fu_rdate)<100,progs$fu_rdate2 ,progs$fu_rdate))
as.Date(ifelse(year(progs$fu_rdate[1])<100,progs$fu_rdate2[1] ,progs$fu_rdate[1]))
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
for(i  in 1:nrow){
if(year(progs$fu_rdate[1])<100){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
for(i  in 1:nrow(progs)){
if(year(progs$fu_rdate[1])<100){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
for(i  in 1:nrow(progs)){
if(year(progs$fu_rdate[1])<100){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
for(i  in 1:nrow(progs)){
year <- year(progs$fu_rdate[1]
if(ifelse(is.na(year),year<100,FALSE){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
for(i  in 1:nrow(progs)){
year <- year(progs$fu_rdate[1]
if(ifelse(is.na(year),year<100,FALSE)){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
ggplot(progs,aes(x=bl_rdate)) + geom_histogram()
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
for(i  in 1:nrow(progs)){
year <- year(progs$fu_rdate[1])
if (ifelse(is.na(year),year<100,FALSE)){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
for(i  in 1:nrow(progs)){
year <- year(progs$fu_rdate[1])
if (ifelse(is.na(year),FALSE,year<100)){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
ggplot(progs,aes(x=bl_rdate)) + geom_histogram()
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
for(i  in 1:nrow(progs)){
year <- year(progs$fu_rdate[1])
if (ifelse(is.na(year),FALSE,year<100)){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
progs$fu_rdate
ggplot(progs,aes(x=year(fu_rdate)))+geom_histogram()
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
for(i  in 1:nrow(progs)){
year0 <- year(progs$fu_rdate[1])
if (ifelse(is.na(year),FALSE,year0<100)){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
ggplot(progs,aes(x=year(fu_rdate)))+geom_histogram()
year0<100
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
for(i  in 1:nrow(progs)){
year0 <- year(progs$fu_rdate[i])
if (ifelse(is.na(year),FALSE,year0<100)){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
progs$fu_rdate
ggplot(progs,aes(x=year(fu_rdate)))+geom_histogram()
year(progs$fu_rdate[i])
i
nrow(progs)
year(progs$fu_rdate2)
year(progs$fu_rdate)
which(year(progs$fu_rdate)<100)
i <- 42
year0 <- year(progs$fu_rdate[i])
year0
ifelse(is.na(year),FALSE,year0<100)
is.na(year)
progs$fu_rdate <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%Y")
progs$fu_rdate2 <- as.Date(gsub(" .*","",progs$Date.of.Progression.biopsy),format="%m/%d/%y")
for(i  in 1:nrow(progs)){
year0 <- year(progs$fu_rdate[i])
if (ifelse(is.na(year0),FALSE,year0<100)){progs$fu_rdate[i]<- progs$fu_rdate2[i]}
}
ggplot(progs,aes(x=year(fu_rdate)))+geom_histogram()
ggplot(progs,aes(x=fu_rdate))+geom_histogram()
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
progs$last.fu <- as.Date(gsub(".* ","",progs$Status),format="%m/%d/%Y")
progs$fup_rdate <- ifelse(is.na(progs$fu_rdate),progs$last.fu,progs$fu_rdate)
progs$fup_rdate
progs$last.fu
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
progs$last.fu
for(i  in 1:nrow(progs)){
year0 <- year(progs$last.fu[i])
if (ifelse(is.na(year0),FALSE,year0<100)){progs$last.fu[i]<- progs$last.fu2[i]}
}
progs$last.fu <- as.Date(gsub(".* ","",progs$Status),format="%m/%d/%Y")
progs$last.fu2 <- as.Date(gsub(".* ","",progs$Status),format="%m/%d/%y")
for(i  in 1:nrow(progs)){
year0 <- year(progs$last.fu[i])
if (ifelse(is.na(year0),FALSE,year0<100)){progs$last.fu[i]<- progs$last.fu2[i]}
}
progs$last.fu
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
progs$Status
progs$prog01 <- ifelse(is.na(as.Date(progs$Date.of.Progression.biopsy,format="%m/%d/%Y")),0,1)
progs$prog01
progs$progression_censor_date <- progs$fu_rdate
progs$progression_censor_date
progs$prog01 <- ifelse(is.na(progs$fu_rdate),0,1)
progs$prog01 <- ifelse(is.na(progs$fu_rdate),0,1)
for(i in 1:nrow(progs)){
if(progs$prog01[i]==0) {progs$progression_censor_date[i] <- progs$last.fu[i]}
}
progs$progression_censor_date
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
progs$fu_time <- progs$progression_censor_date - progs$bl_rdate
progs$fu_time
progs$prog01
progs$last.fu
View(progs)
progs$last.fu
progs$fu_rdate
progs$progression_censor_date <- progs$fu_rdate
progs$progression_censor_date
progs$prog01 <- ifelse(is.na(progs$fu_rdate),0,1)
for(i in 1:nrow(progs)){
if(progs$prog01[i]==0) {progs$progression_censor_date[i] <- progs$last.fu[i]}
}
progs$bl_rdate
View(progs)
progs$fu_time <- progs$progression_censor_date - progs$bl_rdate
progs$fu_time
table(progs$status)
table(progs$Status)
for(i in 1:nrow(progs)){
if(progs$Status[i]=="Active") {progs$progression_censor_date[i] <- as.Date("2016-04-01")}
}
progs$fu_time <- progs$progression_censor_date - progs$bl_rdate
progs$fu_time
as.Date("2016-04-01")
progs$Status
progs$fu_time
progs$progression_censor_date <- progs$fu_rdate
progs$prog01 <- ifelse(is.na(progs$fu_rdate),0,1)
for(i in 1:nrow(progs)){
if(progs$prog01[i]==0) {progs$progression_censor_date[i] <- progs$last.fu[i]}
}
for(i in 1:nrow(progs)){
if(progs$Status[i]=="Active") {progs$progression_censor_date[i] <- as.Date("2016-04-01")}
}
progs$fu_time <- progs$progression_censor_date - progs$bl_rdate
progs$fu_time
progs$progression_censor_date
progs$bl_rdate
progs$fu_time <- progs$progression_censor_date - progs$bl_rdate
progs$fu_time
sum(!is.na(progs$fu_time))
survo <- survfit(Surv(fu_time,prog01),data=progs)
progs$fu_time <- progs$progression_censor_date - progs$bl_rdate
sum(!is.na(progs$fu_time))
survo <- survfit(Surv(fu_time,prog01),data=progs)
? Surv
survo <- survfit(Surv(progs$fu_time,progs$prog01),data=progs)
progs$fu_time <- as.numeric(progs$progression_censor_date - progs$bl_rdate)
sum(!is.na(progs$fu_time))
survo <- survfit(Surv(progs$fu_time,progs$prog01),data=progs)
survo <- survfit(Surv(progs$fu_time,progs$prog01)~1,data=progs)
plot(survo)
progs$fu_time <- as.numeric(progs$progression_censor_date - progs$bl_rdate)  *12/ 365.25
sum(!is.na(progs$fu_time))
survo <- survfit(Surv(progs$fu_time,progs$prog01)~1,data=progs)
plot(survo)
plot(survo,ylim=c(0,1),ylab="Progression-free Survival","Months Since Diagnosis")
plot(survo,ylim=c(0,1),ylab="Progression-free Survival",xlab="Months Since Diagnosis")
progs$prog01
View(progs)
head(progs)
plot(survo,ylim=c(0,1),ylab="Progression-free Survival",xlab="Months Since Diagnosis",main="PASS Progression Subjects (Data Missing)")
plot(survo,ylim=c(0,1),ylab="Progression-free Survival",xlab="Months Since Diagnosis",main="PASS Progression Subjects \n(A lot of Baseline Data Missing)")
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
get.risk.set2(survo)
survo
sfit <- survo
timeby <- 6
ystratalabs <- as.character(levels(summary(sfit)$strata))
ystratalabs
.df <- data.frame(time = sfit$time, n.risk = sfit$n.risk,
n.event = sfit$n.event, surv = sfit$surv, strata = summary(sfit, censored = T)$strata,
upper = sfit$upper, lower = sfit$lower)
sfit
names(sfit)
timeby <- 6
ystratalabs <- as.character(levels(summary(sfit)$strata))
times <- seq(0, max(sfit$time), by = timeby)
.df <- data.frame(time = sfit$time, n.risk = sfit$n.risk,
n.event = sfit$n.event, surv = sfit$surv, strata = 1
upper = sfit$upper, lower = sfit$lower)
.df <- data.frame(time = sfit$time, n.risk = sfit$n.risk,
n.event = sfit$n.event, surv = sfit$surv, strata = 1,
upper = sfit$upper, lower = sfit$lower)
.df
levels(.df$strata) <- ystratalabs
zeros <- data.frame(time = 0, surv = 1, strata = factor(ystratalabs, levels=levels(.df$strata)),
upper = 1, lower = 1)
.df <- rbind.fill(zeros, .df)
risk.data <- data.frame(strata = summary(sfit, times = times, extend = TRUE)$strata,
time = summary(sfit, times = times, extend = TRUE)$time,
n.risk = summary(sfit, times = times, extend = TRUE)$n.risk,n.event=summary(sfit, times = times, extend = TRUE)$n.event)
risk.data$strata2 <- ifelse(risk.data$time==0,gsub(".*=","",as.character(risk.data$strata)),"")
risk.data$time <- ifelse(risk.data$time==0,0.5,risk.data$time)
shift <- 2/1200
times <- seq(0, max(sfit$time), by = timeby)
.df <- data.frame(time = sfit$time, n.risk = sfit$n.risk,
n.event = sfit$n.event, surv = sfit$surv, strata = 1,
upper = sfit$upper, lower = sfit$lower)
levels(.df$strata) <- ystratalabs
zeros <- data.frame(time = 0, surv = 1, strata =1),
upper = 1, lower = 1)
.df <- rbind.fill(zeros, .df)
.df <- rbind.fill(zeros, .df)
timeby <- 6
ystratalabs <- as.character(levels(summary(sfit)$strata))
times <- seq(0, max(sfit$time), by = timeby)
.df <- data.frame(time = sfit$time, n.risk = sfit$n.risk,
n.event = sfit$n.event, surv = sfit$surv, strata = 1,
upper = sfit$upper, lower = sfit$lower)
levels(.df$strata) <- ystratalabs
zeros <- data.frame(time = 0, surv = 1, strata =1,
upper = 1, lower = 1)
.df <- rbind.fill(zeros, .df)
risk.data <- data.frame(strata =1,
time = summary(sfit, times = times, extend = TRUE)$time,
n.risk = summary(sfit, times = times, extend = TRUE)$n.risk,n.event=summary(sfit, times = times, extend = TRUE)$n.event)
risk.data$strata2 <- ifelse(risk.data$time==0,gsub(".*=","",as.character(risk.data$strata)),"")
risk.data$time <- ifelse(risk.data$time==0,0.5,risk.data$time)
risk.data
risk.data <- data.frame(strata =1,
time = summary(sfit, times = times, extend = TRUE)$time,
n.risk = summary(sfit, times = times, extend = TRUE)$n.risk,n.event=summary(sfit, times = times, extend = TRUE)$n.event)
risk.data$strata2 <- ifelse(risk.data$time==0,gsub(".*=","",as.character(risk.data$strata)),"")
risk.data$time <- ifelse(risk.data$time==0,0.5,risk.data$time)
shift <- 2/1200
ddply(risk.data,"strata",function(x){
y <- 0.0135-as.numeric(x$strata[1])*shift
if(legendTF){text(0.5,0.014,"# Events/# at Risk",pos=4)}
print(y)
text(x$time-0.2,y,paste0(x$n.event,"/",x$n.risk),cex=0.8,pos=4)
strata.label <- subset(x,time==min(time))$strata2[1]
print(strata.label)
text(0.1,y+0.5*shift,strata.label,pos=4,cex=0.8)
})
legendTF=TRUE
ddply(risk.data,"strata",function(x){
y <- 0.0135-as.numeric(x$strata[1])*shift
if(legendTF){text(0.5,0.014,"# Events/# at Risk",pos=4)}
print(y)
text(x$time-0.2,y,paste0(x$n.event,"/",x$n.risk),cex=0.8,pos=4)
strata.label <- subset(x,time==min(time))$strata2[1]
print(strata.label)
text(0.1,y+0.5*shift,strata.label,pos=4,cex=0.8)
})
timeby <- 6
ystratalabs <- as.character(levels(summary(sfit)$strata))
times <- seq(0, max(sfit$time), by = timeby)
.df <- data.frame(time = sfit$time, n.risk = sfit$n.risk,
n.event = sfit$n.event, surv = sfit$surv, strata = 1,
upper = sfit$upper, lower = sfit$lower)
levels(.df$strata) <- ystratalabs
zeros <- data.frame(time = 0, surv = 1, strata =1,
upper = 1, lower = 1)
.df <- rbind.fill(zeros, .df)
risk.data <- data.frame(strata =1,
time = summary(sfit, times = times, extend = TRUE)$time,
n.risk = summary(sfit, times = times, extend = TRUE)$n.risk,n.event=summary(sfit, times = times, extend = TRUE)$n.event)
risk.data$strata2 <- ifelse(risk.data$time==0,gsub(".*=","",as.character(risk.data$strata)),"")
risk.data$time <- ifelse(risk.data$time==0,0.5,risk.data$time)
shift <- 2/1200
ddply(risk.data,"strata",function(x){
y <- 0.0135-as.numeric(x$strata[1])*shift
if(legendTF){text(0.5,0.1,"# Events/# at Risk",pos=4)}
print(y)
text(x$time-0.2,y,paste0(x$n.event,"/",x$n.risk),cex=0.8,pos=4)
strata.label <- subset(x,time==min(time))$strata2[1]
print(strata.label)
text(0.1,y+0.5*shift,strata.label,pos=4,cex=0.8)
})
plot(survo,ylim=c(0,1),ylab="Progression-free Survival",xlab="Months Since Diagnosis",main="PASS Progression Subjects \n(A lot of Baseline Data Missing)")
get.risk.set2 <- function(sfit,legendTF=TRUE){
timeby <- 6
ystratalabs <- as.character(levels(summary(sfit)$strata))
times <- seq(0, max(sfit$time), by = timeby)
.df <- data.frame(time = sfit$time, n.risk = sfit$n.risk,
n.event = sfit$n.event, surv = sfit$surv, strata = 1,
upper = sfit$upper, lower = sfit$lower)
levels(.df$strata) <- ystratalabs
zeros <- data.frame(time = 0, surv = 1, strata =1,
upper = 1, lower = 1)
.df <- rbind.fill(zeros, .df)
risk.data <- data.frame(strata =1,
time = summary(sfit, times = times, extend = TRUE)$time,
n.risk = summary(sfit, times = times, extend = TRUE)$n.risk,n.event=summary(sfit, times = times, extend = TRUE)$n.event)
risk.data$strata2 <- ifelse(risk.data$time==0,gsub(".*=","",as.character(risk.data$strata)),"")
risk.data$time <- ifelse(risk.data$time==0,0.5,risk.data$time)
shift <- 2/1200
ddply(risk.data,"strata",function(x){
y <- 0.0135-as.numeric(x$strata[1])*shift
if(legendTF){text(0.5,0.1,"# Events/# at Risk",pos=4)}
print(y)
text(x$time-0.2,y,paste0(x$n.event,"/",x$n.risk),cex=0.8,pos=4)
strata.label <- subset(x,time==min(time))$strata2[1]
print(strata.label)
text(0.1,y+0.5*shift,strata.label,pos=4,cex=0.8)
})
return(risk.data)
}
get.risk.set2(survo,legendTF=TRUE)
ddply(risk.data,"strata",function(x){
y <- 0.0135-as.numeric(x$strata[1])*shift
if(legendTF){text(0.5,0.1,"# Events/# at Risk",pos=4)}
print(y)
text(x$time-0.2,y,paste0(x$n.event,"/",x$n.risk),cex=0.8,pos=4)
strata.label <- subset(x,time==min(time))$strata2[1]
print(strata.label)
text(0.1,y+0.5*shift,strata.label,pos=4,cex=0.8)
})
source('~/Documents/Projects/PCA_Spore/Programs/support_functions/ggkm2.R')
plot(survo,ylim=c(0,1),ylab="Progression-free Survival",xlab="Months Since Diagnosis",main="PASS Progression Subjects \n(A lot of Baseline Data Missing)")
get.risk.set2(survo,legendTF=TRUE)
summary(survo)$table
round(sumtab$0.95LCL)
(sumtab$`0.95LCL`
)
leg <- paste("Median",round(sumtab$median,1) , "95% CI",round(sumtab$`0.95LCL`),"to",round(sumtab$`0.95UCL`))
sumtab <- summary(survo)$table
leg <- paste("Median",round(sumtab$median,1) , "95% CI",round(sumtab$`0.95LCL`),"to",round(sumtab$`0.95UCL`))
round(sumtab$median,1)
sumtab <- summary(survo)$table
class(sumtab)
sumtab[`0.95LCL`]
sumtab["0.95LCL"]
leg <- paste("Median",round(sumtab["median"],1) , "95% CI",round(sumtab["0.95LCL"]),"to",round(sumtab["0.95UCL"]))
leg
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
plot(survo,ylim=c(0,1),ylab="Progression-free Survival",xlab="Months Since Diagnosis",main="PASS Progression Subjects \n(A lot of Baseline Data Missing)")
get.risk.set2(survo,legendTF=TRUE)
sumtab <- summary(survo)$table
leg <- paste("Median",round(sumtab["median"],1) , ", 95% CI",round(sumtab["0.95LCL"]),"to",round(sumtab["0.95UCL"]))
legend("top",legend=leg,bty="none")
plot(survo,ylim=c(0,1),ylab="Progression-free Survival",xlab="Months Since Diagnosis",main="PASS Progression Subjects \n(A lot of Baseline Data Missing)")
get.risk.set2(survo,legendTF=TRUE)
sumtab <- summary(survo)$table
leg <- paste("Median",round(sumtab["median"],1) , ", 95% CI",round(sumtab["0.95LCL"]),"to",round(sumtab["0.95UCL"]))
legend("top",legend=leg,bty="n")
source('~/Documents/Projects/PCA_Spore/Programs/read_data.R')
library(devtools)
load_all()
library(adapr)
rm(list=ls())
set.seed( 2011 )
library(adapr)
library(survival)
library(lubridate)
library(ggplot2)
source.file <-"read_data.R"
project.id <- "PCA_Spore"
source_info <- create_source_file_dir(source.description="reads data")
load_all()
library(adapr)
rm(list=ls())
set.seed( 2011 )
library(adapr)
library(survival)
library(lubridate)
library(ggplot2)
source.file <-"read_data.R"
project.id <- "PCA_Spore"
source_info <- create_source_file_dir(source.description="reads data")
rm(list=ls())
set.seed( 2011 )
library(adapr)
library(survival)
library(lubridate)
library(ggplot2)
source.file <-"read_data.R"
project.id <- "PCA_Spore"
source_info <- create_source_file_dir(source.description="reads data")
rm(list=ls())
set.seed( 2011 )
library(adapr)
library(survival)
library(lubridate)
library(ggplot2)
source.file <-"read_data.R"
project.id <- "PCA_Spore"
source_info <- create_source_file_dir(source.description="reads data")
rm(list=ls())
set.seed( 2011 )
library(adapr)
library(survival)
library(lubridate)
library(ggplot2)
source.file <-"read_data.R"
project.id <- "PCA_Spore"
source_info <- create_source_file_dir(source.description="reads data")
source_info$options
source_info$option
source_info$options
source_info$opt
source_info$opti
source_info$option
source_info$options
load_all()
